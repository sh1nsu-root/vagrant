# Техническое задание для Vagrantfile

## Общие требования
- Создать автоматизированную VM для Java Spring Boot приложения
- Базовый образ: Ubuntu 22.04 LTS (ubuntu/jammy64)
- Автоматическая установка и запуск приложения

## Конфигурационные переменные
Определить переменные для легкой настройки:
- Имя VM: "java-dogs-app"
- Hostname: "dogs-api-server"  
- IP адрес: 192.168.100.100
- Память: 4096 МБ
- CPU: 2 ядра
- Порты: 8080 (host) → 8080 (guest)

## Сетевая конфигурация
- Настроить частную сеть с фиксированным IP
- Включить port forwarding для доступа с хоста
- Добавить автокоррекцию портов при конфликтах

## Оптимизация VirtualBox
- Включить DNS резолверы для улучшения сети
- Использовать virtio для сетевых адаптеров
- Отключить аудио, USB для экономии ресурсов
- Минимальная VRAM (16MB)

## Скрипт установки зависимостей
Создать скрипт install_deps с функциями:
- Включить режим остановки при ошибках (set -e)
- Логирование всех операций
- Retry механизм для apt-get update (3 попытки)
- Проверка доступности пакета перед установкой
- Установка OpenJDK 17 в неинтерактивном режиме
- Верификация установки через java -version

## Скрипт запуска приложения  
Создать скрипт start_app с функциями:
- Переход в директорию /vagrant
- Проверка наличия gradlew файла
- Установка прав на выполнение для gradlew
- Проверка занятости порта и остановка старых процессов
- Запуск в фоновом режиме с логированием в /var/log/spring-boot.log
- Проверка запуска через curl в течение 60 секунд
- Вывод результата и логов при ошибке

## Поддержка провайдеров
Добавить конфигурации для:
- VirtualBox (основной)
- VMware Desktop  
- Hyper-V

## Синхронизация папок
- Оптимизированная синхронизация с правильными правами
- Исключение ненужных файлов (.git, .vagrant, build, *.log)

## SSH оптимизация
- Включить forward agent и X11
- Настроить keep alive

## Триггеры
1. После up:
   - Запустить приложение
   - Показать информационное сообщение с URL и командами
2. Перед halt:
   - Остановить приложение

## Обработка ошибок
- Все скрипты должны корректно обрабатывать ошибки
- Информативные сообщения об успехе/неудаче
- Логирование операций

## Финальный результат
После выполнения `vagrant up` пользователь должен получить:
- Работающую VM с Java приложением
- Доступ к API по адресам http://192.168.100.100:8080/dogs и http://localhost:8080/dogs
- Понятные сообщения о статусе установки
- Готовую к использованию среду разработки
